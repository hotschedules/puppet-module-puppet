# vim: filetype=config tabstop=2 expandtab shiftwidth=2 softtabstop=2 foldmethod=marker smartindent
#
# Puppet Linux Configuration
#
[main]

  # The Puppet log directory.
  # The default value is '$vardir/log'.
  logdir = /var/log/puppet

  # Where Puppet PID files are kept.
  # The default value is '$vardir/run'.
  rundir = /var/run/puppet

  # Where SSL certificates are kept.
  # The default value is '$confdir/ssl'.
  ssldir = $vardir/ssl

  pluginsync  = true
  autoflush   = true

  environment = <%= @env %>

  # Module Path (per puppet environment)
  #
  # NOTE: 'puppet module install' command operates on the first path listed
  #
  # $confdir/
  #  modules/$environment              : 3rd party modules (upstream code ONLY)
  #  environments/$environment/modules : custom/proprietary puppet code & modules
  #
  modulepath          = $confdir/modules/$environment:$confdir/environments/$environment/modules
  #
  # Main Manifest (per puppet environment)
  #
  manifest            = $confdir/environments/$environment/manifests/site.pp


<% if @fqdn == @servername then -%>

[master]
<% if @dns_alt_names then -%>
  dns_alt_names = <%= @dns_alt_names %>
<% end -%>

  # puppetmaster behind Apache-SSL & mod_passenger
  #ssl_client_header = SSL_CLIENT_S_DN
  #ssl_client_verify_header = SSL_CLIENT_VERIFY

  autosign    = true

<% end -%>

  # Immediately pick up configuration changes
  filetimeout = 1

[agent]

  # Client side modules (if present)
  modulepath  = /etc/puppet/modules:/usr/share/puppet/modules

  # disable client RESTful API
  listen      = false

  # The file in which puppetd stores a list of the classes
  # associated with the retrieved configuratiion.  Can be loaded in
  # the separate ``puppet`` executable using the ``--loadclasses``
  # option.
  # The default value is '$confdir/classes.txt'.
  classfile = $vardir/classes.txt

  # Where puppetd caches the local configuration.  An
  # extension indicating the cache format is added automatically.
  # The default value is '$confdir/localconfig'.
  localconfig = $vardir/localconfig

  certname    = <%= @fqdn %>
  server      = <%= @master %>

